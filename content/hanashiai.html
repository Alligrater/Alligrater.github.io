<html>
  <head>
  <script>
  (function(d) {
    var config = {
      kitId: 'pgj7ufp',
      scriptTimeout: 3000,
      async: true
    },
    h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
  })(document);
</script>
	<meta charset="UTF-8">
	<title>Alligrater | Hanashiai</title>
	<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
	<link rel="icon" href="../img/icon.png" />
	<script type="text/javascript">
	//Shit ton of codes here because i'm too lazy to have another file and link them back and forth.
	//Hanashiai-BOT Logic:
	//Wait for input.
	//Receives input.
	//Display a loading icon and wait for a random amount of time.
	//Send back message by using jquery
	//Restart the loop.
	
	//One at a time, no rush. Button is disabled until responded.
	
	let usermessage = "";
	let botmessage = "";
		
	
	/*HanashiaiBot Retrieves Message from here*/
	var chatMap = new Map();
	chatMap.set("关于", "HaNA(SH1)41-Bot<br/>Generation:Genesis0:01<br/>Created by Alligrater, Serve for Alligrater.<br/>The world ends when the world ends when the world ends...");
	chatMap.set("你是谁", "我是Alligrater创造出的第一代聊天机器人Hanashiai-Bot. 正式一点的名字叫HaNA(SH1)41-Bot[Genesis0:01]。这个页面现在由我来负责管理哟~★");
	chatMap.set("推荐", "今日的推荐是……<br/>作品页！非常有意思哟！");
	chatMap.set("Alligrater", "啊，是我的主人←_←!");
	chatMap.set("bilibili", "不来看一发吗（诱惑）<br/><a href=\"http://space.bilibili.com/2936578\" class=\"textlink\">前往哔哩哔哩动画</a>");
	chatMap.set("哔哩哔哩", "不来看一发吗（诱惑）<br/><a href=\"http://space.bilibili.com/2936578\" class=\"textlink\">前往哔哩哔哩动画</a>");
	function hanashiai(){
		if(usermessage != ""){
			console.log(usermessage);
			//上古野良缝合怪(指这一块的代码也是照搬现有的东西)
			var canfind = false;
			for (var entry of chatMap.entries()) {
				var key = entry[0],
				value = entry[1];
				if(usermessage.toLowerCase().indexOf(key) > -1){
					botmessage = value;
					canfind = true;
				}
			}
			if(canfind == false){
				botmessage = "よくわからんな...（困惑）"
			}
			
			//Hanashiai-BOT now recognize your word and is waiting to input soon.
			usermessage = "";
		}
		//Completes all chat and once again allow chat
		botsend();
		botmessage = "";
		document.getElementById('sendbutton').disabled = false;
		timer = setTimeout('hanashiai()', 400);//Simple infinite loop, tuned down for lower grade pcs.
	}
	
	/*Client Side Message Sending*/
	function message(){
		if(document.getElementById('chatbox').value == ""){
			
			return;
		}
		usermessage = document.getElementById('chatbox').value;
		var div = document.getElementById('chatarea');
		greetingmessage = document.createElement("p");
		greetingmessage.innerHTML = usermessage;
		greetingmessage.className = "mikata";
		
		div.insertBefore(greetingmessage, div.lastChild.nextSibling);
		document.getElementById('sendbutton').disabled = true;
		
		//Always scroll to bottom, witchery.
		window.scrollTo(0,document.body.scrollHeight);
		document.getElementById('chatbox').value = "";
	}
	
	/*Bot Side Message Sending*/
	function botsend(){
		if(botmessage == ""){
			return;
		}
		var div = document.getElementById('chatarea');
		greetingmessage = document.createElement("p");
		greetingmessage.innerHTML = botmessage;
		greetingmessage.className = "aite";
		
		div.insertBefore(greetingmessage, div.lastChild.nextSibling);
		
		//Always scroll to bottom, witchery.
		window.scrollTo(0,document.body.scrollHeight);
	}
	
	/*Sends his greetings*/
	function greetings(){
		var div = document.getElementById('chatarea');
		greetingmessage = document.createElement("p");
		greetingmessage.innerHTML = '你好！我是HaNA(sh1)41-Bot。有什么问题都可以来问我哟~！<br/>你可以试试向我用这些关键字发问：<br/>推荐 | Alligrater | 你是谁 | 哔哩哔哩<br/>实际存在的关键词比这个要多，还请多加尝试！';
		greetingmessage.className = "aite";
		div.insertBefore(greetingmessage, div.firstChild);
	}

	
	/*run*/
	var input;
	window.onload = function() {
		input = document.getElementById("chatbox");
			
	//现有的代码为什么不拿来用呢

		// Execute a function when the user releases a key on the keyboard
	input.addEventListener("keyup", function(event) {
		// Cancel the default action, if needed
	event.preventDefault();
		// Number 13 is the "Enter" key on the keyboard
	if (event.keyCode === 13) {
			// Trigger the button element with a click
			document.getElementById("sendbutton").click();
	}
	});
		greetings();
		hanashiai();
	}
	
	//Jquery part that moves 
	</script>
	
	<link rel="stylesheet" type="text/css" href="hanashiai.css">
  </head>
  <body style="padding:0px;margin:0px;">
	<div class = "heading">
	<h2 class="title">Hanashiai</h2>
	<h2 class="subtitle">話し合い</h2>
	</div>
	<nav>
	<a class = "nav" href="homepage.html">Home 主页</a> /
	<a class = "nav" href="projects.html">Projects 项目</a> /
	<a class = "nav" href="ongoing.html">Ongoing 进行中</a> /
	<a class = "nav" href="creations.html">Creations 作品</a> /
	<a class = "nav" href="hanashiai.html"><b>Hanashiai 聊天</a></b> /
	<a class = "nav" href="about.html">About Me 关于我</a> 
	</nav>
	<!-- Everything Goes Beyond Here Should Put in Container.-->
	<center>
	<div class="chatcontainer" id="chatcontainer">
		<div class="chatarea" id="chatarea">
		</div>
		<!-- Put in texts right here before input area-->
	</div>
		<div class="inputarea" id="inputarea">
			<input id="chatbox" class="input" type="text" placeholder="言いたいことを書いてください..."></input>
			<button id="sendbutton" onclick="message()">送信</button>
		</div>
	</center>
	
  </body>
</html>